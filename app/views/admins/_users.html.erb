<script>
$(document).ready(function(){
  var table = $('#myTable').dataTable({
    "aLengthMenu": [[15, 25, 50, 100, -1],
                    [15, 25, 50, 100, "All"]],
    "iDisplayLength" : 15
  });
  table.fnSort( [ [1,'asc'] ] );
});

function searchTable(id, colnb) {
  // Declare variables
  var input, filter, table, tr, td, i;
  input = document.getElementById(id);
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[colnb];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

</script>

<table id="myTable" class="table table-striped table-condensed">
  <thead>
    <tr>
      <th>
        <div class="th-content-container">
          <div class="form-group has-feedback form-group-sm">
            <label class="control-label sr-only">id</label>
            <input type="text" id="idSearch" class="form-control input-sm" onkeyup="searchTable('idSearch', 0)" placeholder="id" >
            <i class="fa fa-search form-control-feedback"></i>
          </div>
          <i class="fa fa-sort fa-sort-with-filter" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">
          <div class="form-group has-feedback">
            <label class="control-label sr-only">username</label>
            <input type="text" id="usernameSearch" class="form-control input-sm" onkeyup="searchTable('usernameSearch', 1)" placeholder="username" >
            <i class="fa fa-search form-control-feedback"></i>
          </div>
          <i class="fa fa-sort fa-sort-with-filter" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">
          <div class="form-group has-feedback form-group-md">
            <label class="control-label sr-only">role</label>
            <input type="text" id="roleSearch" class="form-control input-sm" onkeyup="searchTable('roleSearch', 2)" placeholder="role" >
            <i class="fa fa-search form-control-feedback"></i>
          </div>
          <i class="fa fa-sort fa-sort-with-filter" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">
          <div class="form-group has-feedback">
            <label class="control-label sr-only">email</label>
            <input type="text" id="emailSearch" class="form-control input-sm" onkeyup="searchTable('emailSearch', 3)" placeholder="email" >
            <i class="fa fa-search form-control-feedback"></i>
          </div>
          <i class="fa fa-sort fa-sort-with-filter" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">
          <div class="form-group has-feedback">
            <label class="control-label sr-only">last update</label>
            <input type="text" id="lastUpdateSearch" class="form-control input-sm" onkeyup="searchTable('lastUpdateSearch', 4)" placeholder="last update" >
            <i class="fa fa-search form-control-feedback"></i>
          </div>
          <i class="fa fa-sort fa-sort-with-filter" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">completed
          <i class="fa fa-sort" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">pending
          <i class="fa fa-sort" aria-hidden="true"></i>
        </div>
      </th>
      <th>
        <div class="th-content-container">failed
          <i class="fa fa-sort" aria-hidden="true"></i>
        </div>
      </th>
    </tr>
  </thead>
  <tbody>

    <% @users.each do |user| %>

      <tr align="center">
        <td>
          <%= user.id %>
        </td>
        <td>
          <%= user.username %>
        </td>
        <td>
          <%= user.role %>
        </td>
        <td>
          <%= user.email %>
        </td>
        <td>
          <%= user.updated_at %>
        </td>
        <td>
          <%= user.jobs.select{ |i| i.status == "completed" }.length %>
        </td>
        <td>
          <%= user.jobs.select{ |i| i.status == "pending" }.length %>
        </td>
        <td>
          <%= user.jobs.select{ |i| i.status == "failed" }.length %>
        </td>
      </tr>
    <% end %>

  </tbody>
</table>

<table id="myTableStats" class="table table-condensed">
  <thead>
    <tr>
      <th>users</th>
      <th>completed</th>
      <th>pending</th>
      <th>failed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><%= @users.length %></td>
      <td><%= Job.all.select{ |i| i.status == "completed" }.length %></td>
      <td><%= Job.all.select{ |i| i.status == "pending" }.length %></td>
      <td><%= Job.all.select{ |i| i.status == "failed" }.length %></td>
    </tr>
  </tbody>
</table>
